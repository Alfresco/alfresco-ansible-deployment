name: mirror-libreoffice

on:
  workflow_dispatch:
    inputs:
      libreoffice_version:
        description: The libreoffice version to mirror
        required: true

jobs:
  mirror:
    strategy:
      fail-fast: false
      matrix:
        package_type:
          - deb
          - rpm
    runs-on: ubuntu-latest
    env:
      FILENAME: LibreOffice_${{ inputs.libreoffice_version }}_Linux_x86-64_${{ matrix.package_type }}.tar.gz
    steps:
      - name: Download libreoffice ${{ inputs.libreoffice_version }} ${{ matrix.package_type }}
        run: wget https://downloadarchive.documentfoundation.org/libreoffice/old/${{ inputs.libreoffice_version }}/${{ matrix.package_type }}/x86_64/$FILENAME

      - name: Calculate checksum
        run: |
          sha1sum ${FILENAME} > ${FILENAME}.sha1
          cat ${FILENAME}.sha1

      - name: Deploy to nexus
        uses: Alfresco/alfresco-build-tools/.github/actions/maven-deploy-file@deploy-file-fix
        with:
          group-id: org.libreoffice
          artifact-id: libreoffice-dist-test
          repository-url: https://nexus.alfresco.com/nexus/content/repositories/thirdparty/
          version: ${{ inputs.libreoffice_version }}
          generate-pom: false
          file: LibreOffice_${{ inputs.libreoffice_version }}_Linux_x86-64_${{ matrix.package_type }}.tar.gz
          classifier: ${{ matrix.package_type }}
          maven-username: ${{ secrets.NEXUS_USERNAME }}
          maven-password: ${{ secrets.NEXUS_PASSWORD }}
