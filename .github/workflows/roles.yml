name: "molecule.roles"
on:
  push:
jobs:
  molecule:
    runs-on: ubuntu-latest
    env:
      PY_COLORS: 1
      ANSIBLE_FORCE_COLOR: 1
    strategy:
      fail-fast: true
      matrix:
        molecule_distro:
          - { "image":"centos:7" }
          - { "image":"ubuntu:20.04" }
        role:
          - { "name": "activeq"}
          - { "name": "adw"}
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Set up Python 3.9
        uses: actions/setup-python@v3
        with:
          python-version: '3.9'
          cache: 'pip'
      - run: pip install -r requirements.txt
      - run: ansible-galaxy install -r requirements.yml

      - name: Run tests
        run: |
          cd roles/{{ matrix.role.name }}
          MOLECULE_ROLE_IMAGE=${{ matrix.molecule_distro.image }}
          molecule test