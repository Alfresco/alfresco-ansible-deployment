---
- name: talk to all hosts just so we can learn about them
  hosts: all
  tasks:
    - name: Classify hosts depending on their OS distribution
      group_by:
        key: "{{ ansible_distribution }}{{ ansible_distribution_major_version }}"

- name: Database Role
  hosts: database
  become: true
  become_method: sudo
  roles:
    - role: '../roles/postgres'
  tags:
    - database

- name: Activemq Role
  hosts: activemq
  become: true
  become_method: sudo
  roles:
    - role: '../roles/activemq'
  tags:
    - activemq

- name: Transformers Role
  hosts: transformers
  become: true
  become_method: sudo
  roles:
    - role: '../roles/transformers'
  tags:
    - transformers

- name: Alfresco Search Role
  hosts: search
  become: true
  become_method: sudo
  roles:
    - role: '../roles/search'
  tags:
    - search

- name: Alfresco Repository Role
  hosts: repository
  become: true
  become_method: sudo
  roles:
    - role: '../roles/repository'
  tags:
    - repository

- name: T-Router Role
  hosts: transformers
  become: true
  become_method: sudo
  roles:
    - role: '../roles/trouter'
  tags:
    - trouter

- name: Shared File Store Role
  hosts: transformers
  become: true
  become_method: sudo
  roles:
    - role: '../roles/sfs'
  tags:
    - sfs

- name: Sync Service Role
  hosts: syncservice
  become: true
  become_method: sudo
  roles:
    - role: '../roles/sync'
  tags:
    - sync

- name: Nginx Role
  hosts: webservers
  become: true
  become_method: sudo
  roles:
    - role: '../roles/nginx'
  tags:
    - nginx

- name: Alfresco Digital Workspace Role
  hosts: adw
  become: true
  become_method: sudo
  roles:
    - role: '../roles/adw'
  tags:
    - adw
