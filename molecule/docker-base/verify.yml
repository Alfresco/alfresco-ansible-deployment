- name: Verify
  hosts: all
  gather_facts: false
  tasks:
    - name: Populate service facts
      ansible.builtin.service_facts:

    - name: Check that expected services are up and running
      ansible.builtin.assert:
        quiet: true
        that:
          - ansible_facts.services[item] is defined
          - ansible_facts.services[item].state == 'running'
      loop:
        - activemq.service
        - alfresco-content.service
        - alfresco-search.service
        - alfresco-shared-fs.service
        - alfresco-sync.service
        - alfresco-tengine-aio.service
        - alfresco-transform-router.service
        - nginx.service

    - name: Check that control-center virtualhost is returning expected content
      ansible.builtin.uri:
        url: http://localhost/control-center/
        return_content: true
      register: this
      failed_when: "'Alfresco Admin App' not in this.content"

- name: Run default verify
  import_playbook: ../default/verify.yml
