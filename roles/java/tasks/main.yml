---
# tasks file for roles/java
- name: Download openjdk archive
  get_url:
    url: "{{ dependencies_url.java }}"
    dest: "{{ download_location }}/{{ java_tar_file }}"
    checksum: "sha256:{{ dependencies_url.java_sha256_checksum }}"
    timeout: 570

- name: Install OpenJDK {{ dependencies_version.java }}
  become: true
  block:
    - name: Extract OpenJDK archive
      unarchive:
        src: "{{ download_location }}/{{ java_tar_file }}"
        dest: "{{ java_home | dirname }}"
        remote_src: true
        creates: "{{ java_home }}"
        owner: root
        group: root
        extra_opts:
          - --xform=s,[^/]*,{{ java_home | basename }},

    - name: Configure JRE Keystores
      include_tasks: keystores.yml
      when:
        - java_keystore is defined
        - java_keystore.keys() | length | bool
        - java_keystore.pass
        - java_keystore.path
        - java_keystore.type

    - name: Add setenv bash file
      blockinfile:
        path: "{{ config_folder }}/setenv.sh"
        marker: "# {mark} JAVA ENV VARS"
        create: true
        block: |
          #!/bin/sh
          #
          export JAVA_HOME="{{ java_home }}"
          export PATH="${JAVA_HOME}/bin:${PATH}"
        owner: "{{ username }}"
        group: "{{ group_name }}"
        mode: "0755"
