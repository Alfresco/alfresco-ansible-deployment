---
# tasks file for roles/java
- name: Download file with check (md5)
  get_url:
    url: "{{ dependencies_url.jdk }}"
    dest: "{{ download_location }}/{{ jdk_tar_file }}"
    checksum: "md5:{{ dependencies_url.jdk_md5_checksum }}"
    timeout: 570

- name: Install Java JRE {{ dependencies_version.jdk }}
  become: true
  block:
    - name: Unarchive jdk tar.gz
      unarchive:
        src: "{{ download_location }}/{{ jdk_tar_file }}"
        dest: "{{ java_home | dirname }}"
        remote_src: true
        creates: "{{ java_home }}"
        owner: root
        group: root
        extra_opts:
          - -s
          - /openjdk-{{ dependencies_version.jdk }}_{{ dependencies_version.jdk_arch }}/openjdk-{{ dependencies_version.jdk }}/

    - name: Add setenv bash file
      template:
        src: setenv.sh
        dest: "{{ config_folder }}/setenv.sh"
        owner: "{{ username }}"
        group: "{{ group_name }}"
        mode: "0755"
      tags:
        - molecule-idempotence-notest
