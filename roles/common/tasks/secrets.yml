---
# tasks file for common secrets
- name: Generate tracking/search shared secret (none provided)
  set_fact:
    reposearch_shared_secret: "{{ lookup('password', '/dev/null') }}"
  delegate_to: localhost
  delegate_facts: true
  run_once: true
  when: |
    hostvars.localhost.reposearch_shared_secret is undefined
    and groups.search | default([])

- name: Set tracking/search shared secret
  set_fact:
    reposearch_shared_secret: "{{ hostvars.localhost.reposearch_shared_secret }}"
  when: |
    inventory_hostname in groups.repository | default([]) +  groups.search | default([])
    and hostvars.localhost.reposearch_shared_secret is defined

- name: Override external activemq credentials if present
  set_fact:
    activemq_username: "{{ groups.external_activemq | map('extract', hostvars, ['activemq_username']) | first }}"
    activemq_password: "{{ groups.external_activemq | map('extract', hostvars, ['activemq_password']) | first }}"
  when: groups.external_activemq | default(False)
