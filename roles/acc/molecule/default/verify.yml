- name: Verify
  hosts: all
  gather_facts: true
  vars:
    verify_base_url: http://localhost:8881
  tasks:
    - name: Populate service facts
      ansible.builtin.service_facts:

    - name: Check that Nginx service is up and running
      ansible.builtin.assert:
        that:
          - ansible_facts.services['nginx.service'] is defined
          - ansible_facts.services['nginx.service'].state == 'running'

    - name: Check that the home contains the expected contents
      ansible.builtin.uri:
        url: "{{ verify_base_url }}/"
        return_content: true
      register: this
      failed_when: "'Alfresco Admin App' not in this.content"

    - name: Check that the config contains the expected contents
      ansible.builtin.uri:
        url: "{{ verify_base_url }}/app.config.json"
      register: this
      failed_when: "this.json.authType != 'BASIC'"
