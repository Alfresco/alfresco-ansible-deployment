---
- name: "Create a new database with name {{ repo_db_name }}"
  postgresql_db:
    name: "{{ repo_db_name }}"
    login_host: "{{ db_host }}"
    login_password: "{{ postgres_pass }}"

- name: "Connect to {{ repo_db_name }} database and set user's password with no expire date"
  postgresql_user:
    login_host: "{{ db_host }}"
    login_password: "{{ postgres_pass }}"
    db: "{{ repo_db_name }}"
    name: "{{ repo_db_username }}"
    password: "{{ repo_db_password }}"
    priv: "ALL"
    expires: infinity
    role_attr_flags: SUPERUSER
  no_log: true