---
- name: Include vars for postgres credentials
  include_vars: "postgres.yml"

- name: setting repo host connect
  set_fact: repo_connect="{{ repo_host }}"
  when: hostvars['repository_1'] is undefined

- name: Create a new database with name "alfresco"
  postgresql_db:
    name: "{{ dn_name }}"
    login_host: "{{ db_host }}"
    login_password: "{{ postgres_pass }}"

- name: Connect to alfresco  database and set user's password with no expire date
  postgresql_user:
    login_host: "{{ db_host }}"
    login_password: "{{ postgres_pass }}"
    db: "{{ db_name }}"
    name: "{{ db_user }}"
    password: "{{ db_passwd }}"
    priv: "ALL"
    expires: infinity
    role_attr_flags: SUPERUSER
