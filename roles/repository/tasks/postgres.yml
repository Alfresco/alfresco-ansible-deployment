---
- name: Create a new database with name "alfresco"
  become: true
  become_user: postgres
  postgresql_db:
    name: "{{ item['database'] }}"
    login_host: "{{ hostvars['postgres1']['ansible_host'] }}"
    login_password: "{{ postgres_pass }}"
  with_items: "{{ postgres_client_config }}"
- name: Connect to alfresco  database and set user's password with no expire date
  become: true
  become_user: postgres
  postgresql_user:
    login_host: "{{ hostvars['postgres1']['ansible_host'] }}"
    login_password: "myPassword"
    db: "{{ item['database'] }}"
    name: "{{ item['user'] }}"
    password: "{{ item['passwd'] }}"
    priv: "ALL"
    expires: infinity
    role_attr_flags: SUPERUSER
    login_host: "{{ hostvars['postgres1']['ansible_host'] }}"
  with_items: "{{ postgres_client_config }}"
