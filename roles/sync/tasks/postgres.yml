---
# - name: Configure postgresql client auth
#   lineinfile:
#     path: "{{ postgresql_conf_path[postgres_major_version] }}/pg_hba.conf"
#     insertbefore: BOF
#     line: "{{ item['type'] }}\t{{ item['database'] }}\t{{ item['user'] }}\t{{ item['address'] }}\t{{ item['method'] }}"
#     state: "{{ item['state'] | default(omit) }}"
#     backup: true
#   with_items: "{{ postgres_client_auth }}"
  # notify: Restart postgresql
- name: Create a new database with name "alfresco_sync"
  become: true
  become_user: postgres
  postgresql_db:
    name: "{{ item['database'] }}"
  with_items: "{{ postgres_client_config }}"

- name: Connect to alfresco_sync database and set user's password with no expire date
  become: true
  become_user: postgres
  postgresql_user:
    db: "{{ item['database'] }}"
    name: "{{ item['user'] }}"
    password: "{{ item['passwd'] }}"
    priv: "ALL"
    expires: infinity
    role_attr_flags: SUPERUSER
  with_items: "{{ postgres_client_config }}"
  # notify: Restart postgresql