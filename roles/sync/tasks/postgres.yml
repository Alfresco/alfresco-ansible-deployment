---
- name: setting db host connect
  set_fact: db_host_connect="{{ db_host }}"
  when: hostvars['database_1'] is not defined

- name: debug hostvars
  debug:
    var: hostvars

- name: setting sync host connect
  set_fact: sync_connect="{{ sync_host }}"
  when: hostvars['syncservice_1'] is not defined

- name: Create a new database with name "alfresco_sync"
  postgresql_db:
    name: "{{ item['database'] }}"
    login_host: "{{ db_host_connect }}"
    login_password: "{{ postgres_pass }}"
  with_items: "{{ postgres_client_config }}"

- name: Connect to alfresco_sync  database and set user's password with no expire date
  postgresql_user:
    login_host: "{{ db_host_connect }}"
    login_password: "{{ postgres_pass }}"
    db: "{{ item['database'] }}"
    name: "{{ item['user'] }}"
    password: "{{ item['passwd'] }}"
    priv: "ALL"
    expires: infinity
    role_attr_flags: SUPERUSER
  with_items: "{{ postgres_client_config }}"