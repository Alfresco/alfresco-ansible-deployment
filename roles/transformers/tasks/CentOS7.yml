---
- name: Download imagemagick-distribution-linux.rpm
  get_url:
    url: "{{ dependencies_url.imagemagick_rpm }}"
    dest: "{{ temp_dir }}/imagemagick-distribution-linux.rpm"
    mode: 0444
    url_username: "{{ nexus_user }}"
    url_password: "{{ nexus_password }}"
    timeout: 570
  register: download_img_dist
  until: download_img_dist is succeeded
  when: magick_exists.rc != 0

- name: Download imagemagick-distribution-libs-linux.rpm
  get_url:
    url: "{{ dependencies_url.imagemagick_lib_rpm }}"
    dest: "{{ temp_dir }}/imagemagick-distribution-libs-linux.rpm"
    mode: 0444
    url_username: "{{ nexus_user }}"
    url_password: "{{ nexus_password }}"
    timeout: 570
  register: download_img_libs_dist
  until: download_img_libs_dist is succeeded
  when: magick_exists.rc != 0

- name: install imagemagick-distribution-libs
  yum:
    name: "{{ temp_dir }}/imagemagick-distribution-libs-linux.rpm"
    state: present
  when: download_img_libs_dist is succeeded and magick_exists.rc != 0

- name: install imagemagick-distribution
  yum:
    name: "{{ temp_dir }}/imagemagick-distribution-linux.rpm"
    state: present
  when: download_img_dist is succeeded and magick_exists.rc != 0